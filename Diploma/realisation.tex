\section{Реализация} \label{sub24}

\subsection{Структура модуля} \label{sub241}

Модуль подсветки синтаксиса GRIP~DSL написан на~GDSL(Groovy~DSL) диалекте, который предназначен для поддержки DSL, написанных на~Groovy. 

Модуль состоит из~двух частей:

\begin{itemize}
	\item{функция определения контекста работы модуля;}
	\item{функция разбора файла и определения грамматических конструкций, которые необходимо подсветить.}
\end{itemize} 

Определение контекста происходит посредством вызова специальной функции \texttt{context} с передачей параметров, которые определяют место, где должны подсвечиваться грамматические конструкции GRIP DSL, это может быть:
\begin{itemize}
	\item{расширение файла;}
	\item{полное имя файла;}
	\item{грамматическая конструкция (блок кода, тело метода и т.д.).}
\end{itemize} 

В реализованном модуле контекст определяется как любое замыкание.

Разбор файла и выделение новых полей и их типов реализованно в функции \texttt{contributor}, которая на вход принимает контекст исполнения (имя файла, место вызова), а на выходе неявно возвращает список новых полей и их типов, которые необходимо подсветить.

\subsection{Интеграция модуля с IDE} \label{sub242}

Процесс взаимодействия IDE с~модулем GDSL представлен на~рис.~\ref{img:compiler-structure-2}.

\begin{figure}[ht]
	\centering
	\includegraphics [scale=0.6] {seq}
	\caption{Взаимодействие IDE с~модулем GDSL}
	\label{img:seq}
\end{figure}

При каждом действии пользователя (нажатие на клавишу) IntelliJ~IDEA обращается к GDSL модулю, который находится в проекте, и передаёт ему контекст. GDSL модуль сопоставляет переданный контекст исполнения со своим. Если контекст совпадает, то модуль вызывает функцию \texttt{contributor}, в которой происходит разбор файла и поиск новых грамматических конструкций (динамических полей), определенных в GRIP DSL. Результатом работы модуля является набор имен и типов полей, которые соответствуют синтаксису GRIP DSL. IntelliJ~IDEA подсвечивает эти поля и делает проверку типов.